# 三次握手 四次挥手

三次握手建立连接
三次握手的目的是在客户端和服务器之间建立可靠的 TCP 连接，确保双方都具备发送和接收数据的能力。以下是详细步骤：

第一次握手（SYN = 1, seq = x）
发起方：客户端
过程：客户端向服务器发送一个 SYN（同步）标志位为 1 的 TCP 报文段，同时随机生成一个初始序列号 x。这个报文段表明客户端想要与服务器建立连接。
含义：客户端告诉服务器，我想要和你建立连接，这是我的初始序列号。
第二次握手（SYN = 1, ACK = 1, seq = y, ack = x + 1）
发起方：服务器
过程：服务器收到客户端的 SYN 报文段后，若同意建立连接，会发送一个 SYN 和 ACK（确认）标志位都为 1 的 TCP 报文段。服务器也会随机生成一个初始序列号 y，并将客户端的序列号 x 加 1 作为确认号 ack。
含义：服务器告诉客户端，我收到你的连接请求，同意建立连接，这是我的初始序列号，同时确认收到你的序列号。
第三次握手（ACK = 1, seq = x + 1, ack = y + 1）
发起方：客户端
过程：客户端收到服务器的 SYN + ACK 报文段后，会发送一个 ACK 标志位为 1 的 TCP 报文段。客户端将自己的序列号加 1（x + 1），并将服务器的序列号 y 加 1 作为确认号 ack。
含义：客户端告诉服务器，我收到你的确认，连接已建立，现在可以开始传输数据了。
下面是三次握手的示意图：


plainText
客户端                      服务器
  |                          |
  |  SYN=1, seq=x           |
  | ----------------------> |
  |                          |
  |  SYN=1, ACK=1, seq=y     |
  |  ack=x+1                 |
  | <---------------------- |
  |                          |
  |  ACK=1, seq=x+1          |
  |  ack=y+1                 |
  | ----------------------> |
  |                          |
连接建立
四次挥手断开连接
四次挥手的目的是在客户端和服务器之间安全地断开 TCP 连接，确保双方都完成数据的发送和接收。以下是详细步骤：

第一次挥手（FIN = 1, seq = u）
发起方：客户端或服务器（通常是客户端）
过程：主动关闭方（假设为客户端）向对方发送一个 FIN（结束）标志位为 1 的 TCP 报文段，同时携带自己的序列号 u。这个报文段表明主动关闭方已经没有数据要发送了，但仍可以接收数据。
含义：客户端告诉服务器，我已经完成数据发送，准备关闭连接。
第二次挥手（ACK = 1, seq = v, ack = u + 1）
发起方：被动关闭方（服务器）
过程：被动关闭方收到 FIN 报文段后，会发送一个 ACK 标志位为 1 的 TCP 报文段。被动关闭方将自己的序列号 v 发送给主动关闭方，并将主动关闭方的序列号 u 加 1 作为确认号 ack。
含义：服务器告诉客户端，我收到你的关闭请求，你可以停止发送数据，但我可能还有数据要发送。
第三次挥手（FIN = 1, ACK = 1, seq = w, ack = u + 1）
发起方：被动关闭方（服务器）
过程：当被动关闭方完成数据发送后，会发送一个 FIN 和 ACK 标志位都为 1 的 TCP 报文段。被动关闭方将自己的序列号 w 发送给主动关闭方，并将主动关闭方的序列号 u 加 1 作为确认号 ack。
含义：服务器告诉客户端，我也完成数据发送，准备关闭连接。
第四次挥手（ACK = 1, seq = u + 1, ack = w + 1）
发起方：主动关闭方（客户端）
过程：主动关闭方收到服务器的 FIN + ACK 报文段后，会发送一个 ACK 标志位为 1 的 TCP 报文段。主动关闭方将自己的序列号加 1（u + 1），并将服务器的序列号 w 加 1 作为确认号 ack。
含义：客户端告诉服务器，我收到你的关闭请求，连接已关闭。
下面是四次挥手的示意图：


plainText
客户端                      服务器
  |                          |
  |  FIN=1, seq=u            |
  | ----------------------> |
  |                          |
  |  ACK=1, seq=v            |
  |  ack=u+1                 |
  | <---------------------- |
  |                          |
  |  FIN=1, ACK=1, seq=w     |
  |  ack=u+1                 |
  | <---------------------- |
  |                          |
  |  ACK=1, seq=u+1          |
  |  ack=w+1                 |
  | ----------------------> |
  |                          |
连接关闭
综上所述，三次握手用于建立可靠的 TCP 连接，四次挥手用于安全地断开 TCP 连接，这些机制保证了数据在网络中的可靠传输。

​

Dou